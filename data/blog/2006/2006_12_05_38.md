Одна из неплохих идей от <a href="http://microsoft.com">Microsoft&trade;</a> носит гор(д\н)ое название ActiveDirectory. Для сохранности и конфиденциальности документов <a href="/index.php?page=portfolio">на работе</a> после многочасового совещания меня со мной было принято решения поднимать данное чудо на основе samba сервер-а. Неплохую доку прислал мне товарищ <strong>LightD</strong>. Прочитать ее можно <a href="/media/etc/samba_server.txt">тут</a>.Но, виндовс виндовсом и останется. Через пару дней после реализации в сети появился вирус, который лицензионным (!!!) <a href="http://www.drweb.ru/">DrWeb-ом</a> не определялся. Как потом оказалось, данную заразу подхватила девушка из финансового отдела, т.к. в письме со ссылкой на него было написано "<em>Download this program and you will get 5000$</em>". А ведь этот человек имеет ВО. Так вот, этот вирус расплодился на самба-сервере в немысленных количествах и собирал новые толпы жаждущих быстрого заработка. Ужас, ну да вернемся к нашим баранам.Качаем сырцы clamav. На момент написания последняя стабильная версия 0.8.66.<ins>Дальше по плану:</ins><em># groupadd clamav# useradd -g clamav -s /bin/false clamav</em>далее конфигрим, собираем и инсталлим.По дефолту, конфиг файл лежит в директории<em> /usr/local/etc</em> и называется <em>freshclam.conf</em>. Его, отбросив сомнения, и редактируем.1. Закомментируем строку <em>Example #</em>2. <em>DatabaseDirectory /var/lib/clama</em>v3. <em>DatabaseOwner clamav</em>Рефрешер баз настроили - переходим к настройке самого демона.По тому же пути <em>clamd.conf</em>1. Закомментируем строку <em>Example #</em>2. <em>DatabaseDirectory /var/lib/clamav</em>3. <em>LocalSocket /tmp/clamd</em> (сокет, поэтому позволяем юзеру clamav читать\писать в него )4.<em>User clamav</em>Настойки антивируса готовы. Теперь обновляемся # freshclamav и запускаем <em># clamd</em>.Подразумевается, что самба у нас уже установлена. В моем случае это версия 3.0.22. Далее нам нужен модуль к самбе - <strong>samba v-scan</strong>. Скачать порт для freebsd и сырцы для других unix-like можно по ссылке:<a href="http://www.openantivirus.org/projects.php#samba-vscan">http://www.openantivirus.org/projects.php#samba-vscan</a>Для сборки из cvs вам потребуется samba-sources. После компиляции получим библиотеку <em>vscan-clamav.so</em>, которую копируем в <em>/usr/lib/samba/vfs/</em>, а конфиг <em>vscan-clamav.conf</em> в <i>/etc/samba/.</i>Ну вот, 80 % готово.<strong>Теперь конфигурируем готовое добро.</strong>В smb.conf добавляем в блок конфигурации нужных нам директорий.<em>vfs object = vscan-clamavvscan-clamav:config-file=/etc/samba/vscan-clamav.conf</em>Впринципе, перерывать файл <em>vscan-clamav.conf</em> не имеет смысла. Там и так все настроено. Меняем только<em>clamd socket name = /tmp/clamd</em>Ну вот и все <em># /etc/rc.d/rc.samba restart</em>Радуемся, радуемся, радуемся...
Заказчик из далекой страны победившего капитализма заказал проект в основе которого лежала идея продажи аудио и видео контента через онлайн вещание для мобильных телефонов в формате 3gp для видео либо mp3 для аудио. Пользователь сам заказывает музыку через смс и получает сообщение с ссылкой, по которой, потея от нетерпения, может посмотреть любимый клип с говорящими неграми, грудастыми прыгающими блондинками и прочей второсортной пищей. Нам, человекам, которые значок © ставят только понта ради и считают, что словосочетание "авторские права" родом из падонковского диалекта, подобного расточительства не понять, но за пятью морями сотни подобных сервисов собирают неплохие денежные сбережения для богатой и обеспеченной старости создателей. Это такая себе наводка из серии "как заработать себе на жизнь", в которой я уже пописывал про <a href="/blog/133.html">GPS</a> и <a href="/blog/137.html">Wi-Fi</a>. Все, как во всех сказочных историях, началось с поиска opensource streaming сервера. До этого я однажды устанавливал <a href="http://www.videolan.org/vlc/">VLC</a> для ретрансляции пары дебильных клипов через http, что доставляло немало удовольствия для заказчика, но 3gp данный сервер не поддерживал, поэтому вариант моментально отпал. Погуглив, я наткнулся на бесплатный проект авторства <a href="http://apple.com">Apple</a> с названием <a href="http://dss.macosforge.org/">Darwin</a>, которое, между прочим, носит еще и их OS для их супертонких, супералюминиевых, супердорогих и вообще суперсуперных компьютеров, которые моя врожденная практичность, граничащая с жлобством и скупердяйством, не позволяет купить. Кстати, все релизы (кроме последнего) сервера <a href="http://dss.macosforge.org/post/41/">доступны для скачивания</a>, как для MacOS, так и для Solaris, Linux и даже Windows. Установилось все на centos элементарно: распаковываем архив, запускаем Install скрипт, вводим имя и пароль администратора и получаем готовый, работающий каст-сервер. Итак, все конфиги лежат после установки по адресу /etc/streaming/&nbsp;в удобном для редактирования формате XML. Нас интересуют файл streamingserver.xml, где мы изменяем параметры movie_folder на директорию, в которую будем копировать файлы для просмотра (не забудьте chown qtss), bind_ip_addr для серверов с несколькими IP, в rtsp_port удаляем порт 8000 и 8001, если вам не нужна трансляция через http. Не забываем добавить порты tcp 554 и 7070 (для rtsp) , а так же 1220 для web-интерфейса администратора в ACCEPT фаервола. Далее все просто, потенциальный любитель голоса Бритни отправляет sms с кодом клипа, которое обрабатывает sms gateway-ем (отдельная интересная история) после чего желаемый файл копируется в директорию /usr/local/movies/, а ссылка типа rtsp://serverwithdarwin.com/sdflsdfa798/britney_spears_stronger.3gp высылается пользователю и может быть проиграна, как в дефолтном нокиевском плеере, так и в windows media player mobile и наверное во всех остальных тоже. По истечению 2-х часов файл удаляется cron-ом. Преимущества трансляции перед предоставлением ссылки на файл очевидны: намного меньше нужно платить за лицензию, а жадные дети могут заказывать ссылки на один и тот же клип по несколько раз, Бритни она ведь такая. К тому же через Darwin можно раздавать и mp3 файлы совершенно не парясь с изменением настроек. Сохранить данные из потока намного сложнее, чем обычный файл, а на мобильном устройстве, фактически, невозможно. Одним словом, Apple сделали по настоящему неплохой проект, который и за деньги не жалко было бы купить, а задарма - грех не использовать. Я, в знак благодарности (хотя срали они там на меня), даже решил обновить свой старенький <a href="http://www.engadget.com/2006/09/12/2g-nano-announced/">Nano 2G</a>, с которым бегаю уже ровно 2 года и который ни разу меня не подводил, на последнее поколение этого же <a href="http://www.apple.com/ipodnano/">Nano</a>. Просто&nbsp;4 GB уже как-то маловато, разболтался порт наушников, да и новый интерфейс намного симпатичнее. Вот правда в сторону <a href="http://www.apple.com/ipodtouch/">Touch</a>-ей я даже не смотрю, отсутствия click-wheel, которым в кармане можно и громкость поубавить, и унылый трек переключить, и нудное место в аудиокниге перемотать, сводит все преимущества плеера на нет, но это уже совсем другая история, о которой, я, если обновлюсь, обязательно напишу. Такие дела.
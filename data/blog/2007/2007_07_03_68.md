Давно не писал в раздел <a href='/index.php?cat=7'>(.*)nix</a> - вот исправляюсь.<b>Задача:</b> поднять на <a href='http://www.debian.org/'>Debian GNU/Linux</a> VPN сервер на базе <a href='http://openvpn.net/'>Open VPN</a> (rsa-cert авторизация,) и настроить windows-клиенты.<u>СЕРВЕР</u>:1. apt-get install openvpn (в репозитарии сборка версии 2.0.9-5)2. cp -R /usr/share/openvpn/easy-rsa /etc/openvpn3. nano /etc/openvpn/easy-rsa/vars<pre style="border: 1px inset ; margin: 0px; padding: 6px; overflow: auto; width: 400px; height: 182px; text-align: left;">export D=`pwd`export KEY_CONFIG=$D/openssl.cnfexport KEY_DIR="/etc/openvpn/keys"echo NOTE: when you run ./clean-all, I will be doing a rm -rf on $KEY_DIRexport KEY_SIZE=1024export KEY_COUNTRY=UAexport KEY_PROVINCE=SRexport KEY_CITY=SUMYexport KEY_ORG="SMIRNOFF.HOME"export KEY_EMAIL="spam@gmail.com"</pre>4. mkdir /etc/openvpn/keys5. cd /etc/openvpn/easy-rsa && ./vars. && ./clean-all && ./build-ca && ./build-key-server homegw6.Далее генерируем ключи (/etc/openvpn/easy-rsa/)<pre style="border: 1px inset ; margin: 0px; padding: 6px; overflow: auto; width: 400px; height: 90px; text-align: left;">./build-key [computername]./build-key notebook1./build-key bosssuka etc...</pre>7. ./build-dh8. nano /etc/openvpn/server.conf:<pre style="border: 1px inset ; margin: 0px; padding: 6px; overflow: auto; width: 400px; height: 190px; text-align: left;">port 1194proto tcpdev tunca keys/ca.crtcert keys/homegw.crtkey keys/homegw.keydh keys/dh1024.pemserver 10.20.30.0 255.255.255.0client-config-dir ccdpush "dhcp-option DNS 10.20.30.1"push "redirect-gateway"keepalive 10 120comp-lzopersist-keypersist-tunverb 3</pre>9. /etc/init.d/openvpn start Вуаля, сервер готов. Не забываем при коннекте добавить правило для каждого клиента:<pre style="border: 1px inset ; margin: 0px; padding: 6px; overflow: auto; width: 400px; height: 30px; text-align: left;">iptables -t nat -A POSTROUTING -s 10.20.30.110 -j SNAT --to 10.20.30.1</pre><u>КЛИЕНТ</u>:Использовать мы будем <a href='http://openvpn.se/'>OpenVPN GUI for Windows</a>, который успешно скачиваем и устанавливаем. Далее скачиваем с сервера сгенерированные файлы ключей:<pre style="border: 1px inset ; margin: 0px; padding: 6px; overflow: auto; width: 400px; height: 60px; text-align: left;">/etc/openvpn/keys/ca.crt/etc/openvpn/keys/bosssuka.key/etc/openvpn/keys/bosssuka.crt</pre>Редактируем C:\Program Files\OpenVPN\config\VPNServer.ovpn<pre style="border: 1px inset ; margin: 0px; padding: 6px; overflow: auto; width: 400px; height: 190px; text-align: left;">clientdev tunproto tcpremote 10.20.30.1 1194resolv-retry infinitenobindpersist-keypersist-tunca ca.crtcert bosssuka.crtkey bosssuka.keyns-cert-type serverpush "dhcp-option DNS 10.20.30.1"comp-lzoverb 3route-method exeroute-delay 2</pre>ПКМ на значок в трее, выбираем connect и гордимся, какие мы умные.
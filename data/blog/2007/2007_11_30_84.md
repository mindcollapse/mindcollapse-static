Собственно была поставлена передо мной такая задача - организовать proxy server c доступом по схеме - ПО клиента каждые 5 минут отправляет http get запрос к скрипту, который должен добавлять IP клиента в БД и давать ему доступ к прокси на следующие 5 минут. Зачем это - объяснять долго, сам факт реализации содержал некоторые трудности. Первое разочарование меня постигло, когда я узнал, что <a href="http://www.squid-cache.org/">squid</a>-овские <em>acl src</em>, которые назначаются из файла, кэшируются при старте сквида, а значит легкий вариант с <em>chmod</em> файла со списком IP правами <em>0777</em> и обычным<em> fwrite</em> с <em>a+</em> не проходит... Обидно.Пришлось извращаться, и реализовывать все правой левой пяткой.Собственно вот что получилось:<ul><li><a href="/media/etc/squid.conf">squid.conf</a> +<em> mkdir /etc/my_proxy</em>/ + <em>touch allowed.txt</em> + <em>chmod 0777 allowed.txt</em></li><li>далее - связь клиент-сервер в виде <a href="/media/etc/PHP/cron.phps">php скрипта </a></li><li>далее кидаем в <em>/usr/bin/</em> <a href="/media/etc/PHP/squid_reconfigure">данный файл</a> и не забываем <em>chmod +x</em></li><li>далее, разберемся с sudo привелегиями: посредством visudo добавляем строку <em>nobody ALL = NOPASSWD: /usr/bin/squid_reconfigure</em> , где <ins>nobody </ins>у меня - юзер, под которым живет апач.</li></ul>Вот собственно и все, добавляем в крон что-то типа<em>*/5&nbsp;*&nbsp;*&nbsp;*&nbsp;*&nbsp;links&nbsp;-dump&nbsp;http://*****.*****.com/?action=cron</em>Сессия инициализируется GET-ом на ?action=new, пингуется ?action=ping и прекращается по ?action=terminate.Минус данного метода: если у вас большой конфиг сквида, то на <em>squid -k reconfigure</em> может уйти прилично времени, как процессорного, так и человеческого =)
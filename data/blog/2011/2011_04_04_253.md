В качестве предыстории: я в поте лица и прочих не менее неудачных частей своего бренного тела работаю на славу, процветание и доброе имя компании, которая занимается разработкой "убийцы&nbsp;<a href="http://hidemyass.com/">http://hidemyass.com/</a>" и доброго десятка подобных ему сервисов. О развертывании и структуре сети vpn серверов на базе openvpn, борьбе с torrent трафиком, тоннами спамма, дешевыми vds-ками, индусским&nbsp;англоговорящем&nbsp;на китайском саппортом и прочими прелестями я напишу чуть позже, сегодня мы поговорим с вами об анонимайзере. Вас ист дас, Фальдемар? Дас ист такой себе быстрый браузерный "прокси", что-то типа&nbsp;<a href="http://www.hidemyass.com/proxy/">http://www.hidemyass.com/proxy/</a>, вы вводите ссылку, скрипт скачивает ее и отдает вам, минуя ограничения корпоративных firewall-ов например или скрывая ваш user-agent (кому в хуй ввалился ваш юзерагент, простите? ох уж эта paranoia™). В <a href="http://ru.wikipedia.org/wiki/Веб-прокси">Педевикии</a> есть много текста по данной теме. Как по мне, между нами девочками, - абсолютно ненужная затея, учитывая все сложности ее функционирования. Но, имей мое мнение хоть какой-либо удельный вес, мы бы сейчас занимались производством русского студенческого качественного порно, а не разработкой сервисов анонимности и безопасности в сети. Что достаточно грустно, спрос на порнуху все же много больше, ящетаю. Игнорирование потребностей рынка ведет нас в глухой угол.<p>Хиханьки-хахоньки, но изначально были осмотрены 2 бесплатных решения. <a href="http://sourceforge.net/projects/phpproxy/">PHPproxy</a> и <a href="http://www.glype.com/">Glype</a>. Вот только&nbsp;как-то не удалось мне получить дозу эстетического удовольствия от внутренностей и что самое главное - быстродействия, ну пацаны, 30 регулярок на 1 страницу - как-то слишком, ага. Да и совместимость с современными сайтами, расфуференными AJAX-ами, оставляла желать лучшего. Пришлось писать собственный велосипед. Сразу прошу простить за PHP, увы и ах, но таковы требования заказчиков для "глубокой интеграции" этого говна в глотку сайта. Прежде всего, я отказался от передачи URL проксимизируемого сайта в GET переменной, избрав более интересный путь. Для наглядного примера, данный блог, открытый посредством моего web-прокси, выглядит как https://mindcollapse.com.proxy.domain.com/blabla.html. Плюсы такого элегантного решения: удобная работа с кукисами, которые просто можно назначать данному сабдомену, а не хранить во временных файлах, как это делали вышеназванные реализации, легкость подмены ссылок в странице, в том числе и relative links, которые вообще трогать не нужно. &nbsp;То бишь, мы просто добавляем&nbsp;.proxy.domain.com после доменного имени и направляем весь трафик через наш сервер. Теперь по поводу технологий реализации. Для начала, нам не помешает wildcard SSL сертификат с маской *.domain.com. Ну и никак не обойдемся без *.proxy A Record на неймсерверах нашего с вами домена. В апачевский конфиг sites-enabled/proxy.domain.com.conf добавляем&nbsp;ServerAlias *.proxy.domain.com. Пол работы сделано, теперь дело за малым - написать обработчик данных. Прежде всего, нам нужен правильный .htaccess с&nbsp;RewriteRule ^(.*)$ /proxy.php?$1 [L]. Теперь любые запросы будут реврайтится в REQUEST_URI proxy.php. Не забываем и про&nbsp;RewriteCond %{REQUEST_FILENAME} !-f, а иначе получите вечный редирект в поисках счастья.&nbsp;</p><p>Лирическое отступление по поводу содержания proxy.php. Я как-то уже давненько не подходил к PHP, все в компилируемых языках, да в перлах по самые локти. Кстати, насчет последнего, кто там говорит, что перл мертв - посмотрите на количество живых велосипедов в CPAN. Одних только&nbsp;<a href="http://cpan.uwinnipeg.ca/module/Cache/">интерфейсов кеширования</a>&nbsp;хватит даже чрезвычайно&nbsp;изощренному&nbsp;уму. Ну а про скоропостижную кончину кричит всякая школота, читающая клоаку вроде хабрахабра и мечтающая о заветном инвайте. Да, есть RubyForge и RubyGems, есть Pypi для монти пайтона, даже C# в Microsoft Visual Studio имеет менеджер компонентов, а совсем недавно силами коммьюнити еще и nuget вышел, который я все никак не посмотрю. И да, есть <a href="http://pear.php.net/packages.php">PEAR</a> для PHP. Набор библиотек в нем, мягко говоря, скудный. PEAR "из коробки" не дает ставить пакеты у который релиз статус ниже stable, а как это отключить - приходится гуглить или устанавливать по ссылке, как-то не очень сопоставляется данные действия с определением "удобного менеджера компонентов". Ну да не важно, для нашего прокси мы будем использовать обвязку не вокруг CURL-а, а над&nbsp;fsockopen. Называется <a href="http://pear.php.net/package/HTTP_Request2">HTTP_Request2</a>.&nbsp;Библиотека, между прочим, очень даже ничего. Пожалуй, хватит ходить вокруг да около: вот вам код <a href="/media/copypaste/proxy.php">proxy.php в копипастере</a>. Хочу заметить, что это&nbsp;скорее&nbsp;болванка из которой я убрал большу часть кода используемую при разборе джаваскриптов и css, да и добрый 10к плагинов, которые заставляли работать ютубы и фейсбуки. Ничего там сложного нет, просто firebug или chrome developer tools вам в руки и копайтесь в куче непонятных кукисов и сжатых js-скриптов.&nbsp;Для последних, кстати, есть отличная утилита -&nbsp;<a href="http://jsbeautifier.org/" style="color:rgb(0,0,255);">JSBeautifier</a>.&nbsp;Так что не нужно кричать "хааа, лох, у тебя же никак не проверяется вводимый урл, хаааа". Проверяется. Христом богом клянусь. У меня все.</p>
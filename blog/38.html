<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">

    <title>Samba server + clamav</title> 

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="jm8IGIWg4dsm0cTmih0sIVnUaWibc_hpOiQOlqb--9Y"> 
    <meta name="yandex-verification" content="4b85f46617ab1114"> 
    <meta name="y_key" content="04bed234d6a405cc"> 
    <meta name="msvalidate.01" content="62188F55275960794DDFA698C3EA9F05">

    <link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.ru">
    <link rel="sitemap" href="https://www.mindcollapse.com/blog/sitemap.xml">

    
        <link rel="canonical" href="https://www.mindcollapse.com/blog/38.html">

        
            <link rel="next" href="https://www.mindcollapse.com/blog/37.html">
        

        
            <link rel="prev" href="https://www.mindcollapse.com/blog/39.html">
        

        <meta property="og:title" content="Samba server + clamav">
        <meta property="og:description" content="Одна из неплохих идей от Microsoft™ носит гор(д\н)ое название ActiveDirectory. Для сохранности и конфиденциальности документов на работе после многочасового совещания меня со мной было принято решения поднимать данное чудо на основе samba сервер-а. Неплохую ...">
        <meta property="og:type" content="article">
        <meta property="og:site_name" content="mindcollapse.com">
        <meta property="og:url" content="https://www.mindcollapse.com/blog/38.html">

        <meta name="description" content="Одна из неплохих идей от Microsoft™ носит гор(д\н)ое название ActiveDirectory. Для сохранности и конфиденциальности документов на работе ...">

        <meta name="twitter:creator" content="@middlesizetit">
        <meta name="twitter:description" content="Одна из неплохих идей от Microsoft™ носит гор(д\н)ое название ActiveDirectory. Для сохранности и конфиденциальности документов на работе после многочасового совещания ...">
        <meta name="twitter:title" content="Samba server + clamav">

        
            <meta name="twitter:card" content="summary">
        
    

    <link rel="publisher" href="https://plus.google.com/110904145311662435301">
    <link rel="icon" href="https://www.mindcollapse.com/favicon.ico" type="image/vnd.microsoft.icon">
    <link rel="alternate" type="application/atom+xml" title="RSS лента mindcollapse.com" href="https://www.mindcollapse.com/blog.xml"> 

    
        <link href="/static/compiled/blog.css?85fbe913" rel="stylesheet" media="all">
    

    
        <script type="text/javascript" src="/static/compiled/blog.js?06c0e12a"></script>
    

    <!--[if lt IE 9]>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js"></script>
    <![endif]-->
</head>

<body class="mindcollapse">
    <main class="container">
        <header class="header navbar navbar-default hidden-print">
            <nav class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".blogmenu">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a href="/" class="navbar-brand">Владимир Смирнов</a>
            </nav>

            <nav class="collapse navbar-collapse blogmenu" role="navigation">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="/">Блог</a></li>
                    <li ><a href="/blog/archive/">Архив</a></li>
                    <li><a target="_blank" href="/moho/">Кино</a></li>
                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <li><a target="_blank" href="http://www.twitter.com/middlesizetit">Twitter</a></li>
                    <li><a target="_blank" href="https://github.com/mindcollapse">GitHub</a></li>
                    <li><a href="https://www.mindcollapse.com/blog.xml">RSS</a></li>
                </ul>
            </nav>
        </header>

        
    <article class="article hentry" itemscope itemtype="http://schema.org/Article" role="main">
        <div class="content_header clearfix">
            <div itemprop="name" class="entry-title pull-left">
                <h1><a itemprop="url" href="https://www.mindcollapse.com/blog/38.html">Samba server + clamav</a></h1>
            </div>

            <div class="published pull-right">
                <time itemprop="datePublished" datetime="2006-12-05T00:00:00Z" class="text-muted updated">5 декабря 2006 г.</time>
            </div>

            <div class="vcard author hidden">
                <a itemprop="author" class="url fn" href="http://www.mindcollapse.com/">Vladimir Smirnov</a>
            </div>
        </div>

        <hr class="first">

        <div itemprop="description" class="entry-content content">
            Од­на из не­пло­хих идей от <a href="http://microsoft.com">Microsoft&trade;</a> но­сит гор(д\н)ое на­зва­ние ActiveDirectory. Для со­хран­но­сти и кон­фи­ден­ци­аль­но­сти до­ку­мен­тов <a href="/index.php?page=portfolio">на ра­бо­те</a> по­сле мно­го­ча­со­во­го со­ве­ща­ния ме­ня со мной бы­ло при­ня­то ре­ше­ния под­ни­мать дан­ное чу­до на осно­ве samba сер­вер-а. Не­плохую до­ку при­слал мне то­ва­рищ <strong>LightD</strong>. Про­чи­тать ее мож­но <a href="/media/etc/samba_server.txt">тут</a>.Но, вин­довс вин­дов­сом и оста­нет­ся. Че­рез па­ру дней по­сле ре­а­ли­за­ции в се­ти по­явил­ся ви­рус, ко­то­рый ли­цен­зи­он­ным (!!!) <a href="http://www.drweb.ru/">DrWeb-ом</a> не опре­де­лял­ся. Как по­том ока­за­лось, дан­ную за­ра­зу под­хва­ти­ла де­вуш­ка из фи­нан­со­во­го от­де­ла, т.к. в пись­ме со ссыл­кой на не­го бы­ло на­пи­са­но "<em>Download this program and you will get 5000$</em>". А ведь этот че­ло­век име­ет ВО. Так вот, этот ви­рус рас­пло­дил­ся на сам­ба-сер­ве­ре в не­мыс­лен­ных ко­ли­че­ствах и со­би­рал но­вые тол­пы жа­жду­щих бы­стро­го за­ра­бот­ка. Ужас, ну да вер­нем­ся к на­шим ба­ра­нам.Ка­ча­ем сыр­цы clamav. На мо­мент на­пи­са­ния по­след­няя ста­биль­ная вер­сия 0.8.66.<ins>Даль­ше по пла­ну:</ins><em># groupadd clamav# useradd -g clamav -s /bin/false clamav</em>да­лее кон­фи­грим, со­би­ра­ем и ин­стал­лим.По де­фол­ту, кон­фиг файл ле­жит в ди­рек­то­рии<em> /usr/local/etc</em> и на­зы­ва­ет­ся <em>freshclam.conf</em>. Его, от­бро­сив со­мне­ния, и ре­дак­ти­ру­ем.1. За­ком­мен­ти­ру­ем стро­ку <em>Example #</em>2. <em>DatabaseDirectory /var/lib/clama</em>v3. <em>DatabaseOwner clamav</em>Ре­фре­шер баз на­стро­и­ли - пе­ре­хо­дим к на­строй­ке са­мо­го де­мо­на.По то­му же пу­ти <em>clamd.conf</em>1. За­ком­мен­ти­ру­ем стро­ку <em>Example #</em>2. <em>DatabaseDirectory /var/lib/clamav</em>3. <em>LocalSocket /tmp/clamd</em> (со­кет, по­это­му поз­во­ля­ем юзе­ру clamav чи­тать\пи­сать в не­го )4.<em>User clamav</em>На­стой­ки ан­ти­ви­ру­са го­то­вы. Те­перь об­нов­ля­ем­ся # freshclamav и за­пус­ка­ем <em># clamd</em>.Под­ра­зу­ме­ва­ет­ся, что сам­ба у нас уже уста­нов­ле­на. В мо­ем слу­чае это вер­сия 3.0.22. Да­лее нам ну­жен мо­дуль к сам­бе - <strong>samba v-scan</strong>. Ска­чать порт для freebsd и сыр­цы для дру­гих unix-like мож­но по ссыл­ке:<a href="http://www.openantivirus.org/projects.php#samba-vscan">http://www.openantivirus.org/projects.php#samba-vscan</a>Для сбор­ки из cvs вам по­тре­бу­ет­ся samba-sources. По­сле ком­пи­ля­ции по­лу­чим биб­лио­те­ку <em>vscan-clamav.so</em>, ко­то­рую ко­пи­ру­ем в <em>/usr/lib/samba/vfs/</em>, а кон­фиг <em>vscan-clamav.conf</em> в <i>/etc/samba/.</i>Ну вот, 80 % го­то­во.<strong>Те­перь кон­фи­гу­ри­ру­ем го­то­вое до­бро.</strong>В smb.conf до­бав­ля­ем в блок кон­фи­гу­ра­ции нуж­ных нам ди­рек­то­рий.<em>vfs object = vscan-clamavvscan-clamav:config-file=/etc/samba/vscan-clamav.conf</em>Вприн­ци­пе, пе­ре­ры­вать файл <em>vscan-clamav.conf</em> не име­ет смыс­ла. Там и так все на­стро­е­но. Ме­ня­ем толь­ко<em>clamd socket name = /tmp/clamd</em>Ну вот и все <em># /etc/rc.d/rc.samba restart</em>Ра­ду­ем­ся, ра­ду­ем­ся, ра­ду­ем­ся...
        </div>
    </article>

    <hr>

    <footer class="footer hidden-print">
        <p>Что делать, если вы все прочитали и вам понравилось? Можете посмотреть мои остальные статьи в <a href="/blog/archive/">архиве</a> или поделиться радостью со своими воображаемыми друзьями в социальных сетях: <span class="social"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3A//www.mindcollapse.com/blog/38.html">фейсбук</a>, <a target="_blank" href="http://twitter.com/share?url=https%3A//www.mindcollapse.com/blog/38.html&amp;text=Samba%20server%20%2B%20clamav&amp;via=middlesizetit">твиттер</a>, <a target="_blank" href="http://vkontakte.ru/share.php?url=https%3A//www.mindcollapse.com/blog/38.html">вконтакте</a></span>.</p>
    </footer>

    </main>   
</body>

</html>
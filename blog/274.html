<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">

    <title>Пишем Skype бот с искусственными мозгами</title> 

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="jm8IGIWg4dsm0cTmih0sIVnUaWibc_hpOiQOlqb--9Y"> 
    <meta name="yandex-verification" content="4b85f46617ab1114"> 
    <meta name="y_key" content="04bed234d6a405cc"> 
    <meta name="msvalidate.01" content="62188F55275960794DDFA698C3EA9F05">

    <link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.ru">
    <link rel="sitemap" href="https://www.mindcollapse.com/blog/sitemap.xml">

    
        <link rel="canonical" href="https://www.mindcollapse.com/blog/274.html">

        
            <link rel="next" href="https://www.mindcollapse.com/blog/273.html">
        

        
            <link rel="prev" href="https://www.mindcollapse.com/blog/275.html">
        

        <meta property="og:title" content="Пишем Skype бот с искусственными мозгами">
        <meta property="og:description" content="Существует два способа взаимодействия со скайпом. Первый и основной - SkypeKit. Это набор из бинарного ядра, заботливо собранного мейнтейнером для всех ОС, и биндингов к нему на питоне, джаве и плюсах. Все это доступно по подписке, которая стоит 5 долларов ...">
        <meta property="og:type" content="article">
        <meta property="og:site_name" content="mindcollapse.com">
        <meta property="og:url" content="https://www.mindcollapse.com/blog/274.html">

        <meta name="description" content="Существует два способа взаимодействия со скайпом. Первый и основной - SkypeKit. Это набор из бинарного ядра, заботливо собранного ...">

        <meta name="twitter:creator" content="@middlesizetit">
        <meta name="twitter:description" content="Существует два способа взаимодействия со скайпом. Первый и основной - SkypeKit. Это набор из бинарного ядра, заботливо собранного мейнтейнером для всех ОС, и биндингов к ...">
        <meta name="twitter:title" content="Пишем Skype бот с искусственными мозгами">

        
            <meta name="twitter:card" content="summary">
        
    

    <link rel="publisher" href="https://plus.google.com/110904145311662435301">
    <link rel="icon" href="https://www.mindcollapse.com/favicon.ico" type="image/vnd.microsoft.icon">
    <link rel="alternate" type="application/atom+xml" title="RSS лента mindcollapse.com" href="https://www.mindcollapse.com/blog.xml"> 

    
        <link href="/static/compiled/blog.css?47e4fb13" rel="stylesheet" media="all">
    

    
        <script type="text/javascript" async src="/static/compiled/blog.js?c6c1320e"></script>
    

    <!--[if lt IE 9]>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js"></script>
    <![endif]-->
</head>

<body class="mindcollapse">
    <main class="container">
        <header class="header navbar navbar-default hidden-print">
            <nav class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".blogmenu">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a href="/" class="navbar-brand">Владимир Смирнов</a>
            </nav>

            <nav class="collapse navbar-collapse blogmenu" role="navigation">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="/">Блог</a></li>
                    <li ><a href="/blog/archive/">Архив</a></li>
                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <li><a target="_blank" href="https://twitter.com/middlesizetit">Twitter</a></li>
                    <li><a target="_blank" href="https://github.com/mindcollapse">GitHub</a></li>
                    <li><a href="https://www.mindcollapse.com/blog.xml">RSS</a></li>
                </ul>
            </nav>
        </header>

        
    <article class="article hentry" itemscope itemtype="http://schema.org/Article" role="main">
        <div class="content_header clearfix">
            <div itemprop="name" class="entry-title pull-left">
                <h1><a itemprop="url" href="https://www.mindcollapse.com/blog/274.html">Пишем Skype бот с искусственными мозгами</a></h1>
            </div>

            <div class="published pull-right">
                <time itemprop="datePublished" datetime="2012-03-28T00:00:00Z" class="text-muted updated">28 марта 2012 г.</time>
            </div>

            <div class="vcard author hidden">
                <a itemprop="author" class="url fn" href="http://www.mindcollapse.com/">Vladimir Smirnov</a>
            </div>
        </div>

        <hr class="first">

        <div itemprop="description" class="entry-content content">
            Су­ще­ству­ет два спо­со­ба вза­и­мо­дей­ствия со скай­пом. Пер­вый и основ­ной - <a href="http://developer.skype.com/public/skypekit">SkypeKit</a>. Это на­бор из би­нар­но­го ядра, за­бот­ли­во со­бран­но­го мей­н­тей­не­ром для всех ОС, и бин­дин­гов к не­му на пи­то­не, джа­ве и плю­сах. Все это до­ступ­но по под­пис­ке, ко­то­рая сто­ит 5 дол­ла­ров разо­вым пла­те­жом и по­став­ля­ет­ся со скуд­ной до­ку­мен­та­ци­ей, ко­то­рая пред­став­ля­ет со­бой ско­рее <a href="http://developer.skype.com/skypekit/reference/python/html/">опи­са­ние API</a>&nbsp;(нам не при­вы­кать к Epydoc, ага), да и то не всех ме­то­дов и свойств. За­то в на­груз­ку вы по­лу­чи­те с де­ся­ток раз­ных пре­ду­пре­жде­ний о се­крет­но­сти и кон­фи­ден­ци­аль­но­сти по­лу­чен­ных фай­лов. А вот ка­че­ство ре­а­ли­за­ции очень хро­ма­ет, ваш по­кор­ный слу­га так и не смог най­ти тот event, ко­то­рый под­ни­ма­ет­ся при по­лу­че­ния за­про­са на ав­то­ри­за­цию. В ин­тер­не­те, что ха­рак­тер­но, ин­фор­ма­ции то­же су­щие кру­пи­цы и, в боль­шин­стве сво­ем, по бин­дин­гу на C++, но, разо­брав­шись со всем не­об­хо­ди­мым функ­ци­о­на­лом ме­то­дом проб и оши­бок, вы по­лу­чи­те до­ступ к аб­со­лют­но всем функ­ци­ям Skype. Ну и для за­пус­ка би­нар­ни­ка ядра из SkypeKit SDK в той же Linux вер­сии ни­ка­кие ик­сы не нуж­ны, что то­же за­мет­ное пре­иму­ще­ство пе­ред вто­рым спо­со­бом - <a href="http://developer.skype.com/public-api-reference">Skype API</a>. Этот ва­ри­ант пред­став­ля­ет из се­бя на­бор про­то­ко­лов вза­и­мо­дей­ствия с скай­по­вым гу­ем че­рез Skype.framework для MacOS, X11 и DBUS для Linux, COM-ин­тер­фейс на Windows. Основ­ные ми­ну­сы: острая не­об­хо­ди­мость в за­пу­щен­ном кли­ен­те, ко­то­рый жрет ре­сур­сы и тре­бу­ет на­ли­чия ик­сов, ну и от­но­си­тель­ная глюч­ность, срав­ни­тель­но с пер­вым ва­ри­ан­том.&nbsp;<div><br /></div><div>Хо­дят без­дар­ные&nbsp;<a href="http://news.ycombinator.com/item?id=2611299">слу­хи</a>, что в ско­ром вре­ме­ни мы по­лу­чим еще и тре­тий спо­соб - на­тив­ная биб­лио­те­ка без ка­ких-ли­бо ли­ми­тов. По­доб­ные раз­го­во­ры на­ча­лись по­сле деоб­фус­ка­ции би­нар­ни­ка скай­па и про­дол­жа­ют­ся по ме­ре на­пол­не­ния ре­по­зи­то­рия&nbsp;<a href="https://github.com/skypeopensource/">https://github.com/skypeopensource/</a>.&nbsp;Хо­тя, меж­ду на­ми, де­воч­ка­ми, на­пол­ня­ет­ся он ко­дом та­ко­го низ­ко­го ка­че­ства, что ме­ня одо­ле­ва­ют со­мне­ния, бу­дет ли до­ве­ден про­ект до ра­бо­че­го об­раз­ца.<div><br /></div><div>Я ре­шил ис­поль­зо­вать SkypeAPI. Преж­де все­го, я во­об­ще не знал о су­ще­ство­ва­нии SkypeKit, вот та­кой вот стыд­ный про­кол. Впро­чем, оно и к луч­ше­му, мень­ше вре­ме­ни ушло на на­пи­са­ние то­го, что не ра­бо­та­ло. Ана­ло­гов не­об­хо­ди­мых мне функ­ций, до­ступ­ных в ста­рой пи­то­нов­ской биб­лио­тек&nbsp;<a href="http://skype4py.sourceforge.net/doc/html/">Skype4Py</a>, в SDK про­сто про­сто не ока­за­лось. До­пус­каю, что я про­сто пло­хо ис­кал, но тем не ме­нее. Бо­та мы с ва­ми бу­дем пи­сать не про­сто­го, а ум­но­го, ко­то­рый смо­жет под­дер­жи­вать эле­мен­тар­ный раз­го­вор, ну или да­же по­слать. Тут нам на по­мощь при­хо­дит&nbsp;<a href="http://en.wikipedia.org/wiki/AIML">AIML</a>&nbsp;- XML-про­из­вод­ный язык раз­мет­ки ло­ги­ки бо­тов в сти­ле "по­бол­тать". Со­всем удач­но на­шлась и биб­лио­те­ка&nbsp;<a href="http://pyaiml.sourceforge.net/">PyAIML</a>, ко­то­рая сде­ла­ла со­зда­ние ум­но­го болт­ли­во­го ро­бо­та де­лом трех строк ко­да. Для на­ча­ла, нам нуж­ны моз­ги.&nbsp;</div><div><br /></div><div>Моз­ги мож­но взять в мяс­ном ма­га­зи­не, сту­шить их вме­сте с цвет­ной ка­пу­стой или спар­же­вой фа­со­лью, по­дать с бе­лым ви­ном, за­бив на про­дол­же­ние это­го по­ста. Если та­кие ку­ли­нар­ные изыс­ки вас не пре­льща­ют, то от­кры­вай­те <a href="http://code.google.com/p/aiml-en-us-foundation-alice/">Google Code</a>, ку­да до­брые лю­ди вы­ло­жи­ли и до сих пор про­дол­жа­ют ко­ми­тить боль­шой жир­ный сет aiml-ок, ко­то­рые по­мо­гут ма­ши­не на­чать ду­мать и чув­ство­вать. Преж­де чем про­дол­жить, нуж­но пе­ре­ве­сти моз­ги из XML раз­мет­ки в би­нар­ный фор­мат, ина­че каж­дый раз ваш бот бу­дет за­пус­кать­ся по 5-10 ми­нут. Все это де­ла­ет­ся с по­мо­щью <a href="https://code.google.com/p/mindcollapse-com-blog-source/source/browse/small_projects/SkypeBot/Learn.py">та­ко­го про­сто­го ко­да</a> на Python. Будь­те го­то­вы к ис­прав­ле­ни­ям фай­лов сво­и­ми соб­ствен­ны­ми ру­ка­ми, мно­гие из них про­сто не про­хо­дят ва­ли­да­цию и пар­сер от­ва­ли­ва­ет­ся с пе­чаль­ны­ми но­во­стям. Обыч­но все про­бле­мы ли­бо в не­за­кры­том те­ге, ли­бо в не­экра­ни­ро­ван­ном спец­сим­во­ле, или точ­ке гу­ля­щей. Про­цесс это уто­ми­тель­ный и не­спеш­ный, но во всем есть свои плю­сы: по ме­ре ре­дак­ти­ро­ва­ния вы по­зна­ко­ми­тесь с син­так­си­сом AIML.</div></div><div><br /></div><div>На этом мож­но бы­ло бы и за­кон­чить, 3 стро­ки ко­да и ваш бот на­учил­ся го­во­рить и от­ве­чать на по­лу­чен­ные со­об­ще­ния. &nbsp;Но нам все ма­ло. Да­вай­те при­де­ла­ем воз­мож­ность взять труб­ку и по­го­во­рить го­ло­сом с за­де­лом на крос­с­плат­фор­мен­ность, све­дя за­ви­си­мо­сти и слож­ность ко­да к ми­ни­му­му. Для это­го мы бу­дем ис­поль­зо­вать 2 би­нар­ни­ка, ко­то­рые со­би­ра­ют­ся под все­ми си­сте­ма­ми, и 2 нео­фи­ци­аль­ных APIш­ки от Google. Вни­ма­ние, код и опи­са­ние предо­став­ле­ны ис­клю­чи­тель­но для озна­ком­ле­ния. Я на­сто­я­тель­но не ре­ко­мен­дую на­ру­шать ли­цен­зи­он­ное со­гла­ше­ние. По­мни, каж­дый раз, ко­гда ты от­прав­ля­ешь за­прос по этим ссыл­кам, Эрик Шмидт уби­ва­ет ко­тен­ка.&nbsp;Нуж­но бы­ло на­пи­сать, уже бы­ли пре­це­ден­ты. Вер­нем­ся к на­шим API. Пер­вый - TTS, ко­то­рый ис­поль­зу­ет­ся в Google Translate и пе­ре­во­дит текст в MP3. Как это ра­бо­та­ет, мо­же­те <a href="https://code.google.com/p/mindcollapse-com-blog-source/source/browse/small_projects/SkypeBot/__init__.py#186">по­смот­реть в ко­де</a>. Впро­чем, ра­но ра­до­вать­ся - наш Skype не пой­мет, если ему в Output ка­нал мы бу­дем за­со­вы­вать не теп­лый лам­по­вый WAV (16Khz, 256kb/s, Mono), а ужа­тый MPEG. Я пы­тал­ся де­ко­ди­ро­вать с по­мо­щью ме­ди­а­ком­бай­на ffmpeg, но Скайп на­от­рез от­ка­зы­вал­ся по­ни­мать по­лу­чен­ный файл. Имен­но по­это­му, мы и бу­дем ис­поль­зо­вать <a href="http://www.mpg123.de/">mpg123</a>, ко­то­рый очень бы­стро справ­ля­ет­ся с по­став­лен­ной за­да­чей. Вот так у нас и по­лу­чи­лась функ­ция пе­ре­во­да тек­ста в речь, ко­то­рую вы мо­же­те ис­поль­зо­вать в лю­бом про­ек­те. Идем даль­ше - <a href="https://code.google.com/p/mindcollapse-com-blog-source/source/browse/small_projects/SkypeBot/__init__.py#147">за­пи­сы­ва­ем</a> 10 се­кунд ре­чи на­ше­го со­бе­сед­ни­ка и тут бы не по­ме­ша­ло пе­ре­ве­сти ее в текст. Нам опять по­мо­жет Google и API, выдран­ное из Хро­ми­у­ма, ко­то­рое как раз этим и за­ни­ма­ет­ся. Тут воз­ни­ка­ет сле­ду­ю­щая про­бле­ма - &nbsp;от­да­вать нуж­но не WAV, a FLAC. К сча­стью, есть од­но­имен­ный про­ект <a href="http://flac.sourceforge.net/">на сурс­фор­же,</a> ко­то­рый ма­ло то­го, что крос­с­плат­фор­мен­ный, так еще и бы­стрый, как во­об­ра­же­ние школь­ни­ка в жен­ской раз­де­вал­ке.</div><div><br /></div><div><a href="https://code.google.com/p/mindcollapse-com-blog-source/source/browse/small_projects/SkypeBot/__init__.py">Итог</a> за­пус­ка­ет­ся вме­сте с скай­пов­ским GUI в ка­ком-то Xvfb или да­же в Xvnc, что пред­по­чти­тель­ней, так как вам нуж­но бу­дет под­твер­дить пра­ва до­сту­па на­шей про­грам­мы к API кли­ком мы­ши. В ка­че­стве про­вер­ки мо­же­те <a href="skype:alice.mindcollapse?chat">на­пи­сать</a> или <a href="skype:alice.mindcollapse?call">по­зво­нить</a>&nbsp;на ID alice.mindcollapse. Она бу­дет до­ступ­на не круг­ло­су­точ­но. Если оста­ет­ся мол­ча­ли­вой - зна­чит ушла спать вме­сте со мной и от­ве­тит, глав­ное, ото­шли­те ей за­прос на ав­то­ри­за­цию. Ах да, в блог, сле­дуя мо­де, вер­ну­лись со­ци­аль­ные кноп­ки. Те­перь все в ва­ших ру­ках: сто­ит ли мне пи­сать о сво­ем пер­вом сек­су­аль­ном опы­те со сле­пой уса­той про­сти­ту­кой, или рас­ска­зы­вать о на­пи­са­нии мо­ду­ля ядра для Embedded Linux. Про­сто <a href="http://www.mindcollapse.com/blog/274.html">пе­рей­ди­те на веб вер­сию</a> по­ста и щелк­ни­те ле­ни­во мыш­кой, по­ста­вив +1 или рас­ска­зав бра­тю­ням. Ван лов, па­цан­ва.&nbsp;</div>
        </div>
    </article>

    <hr>

    <footer class="footer hidden-print">
        <p>Что делать, если вы все прочитали и вам понравилось? Можете посмотреть мои остальные статьи в <a href="/blog/archive/">архиве</a> или поделиться ссылкой в <span class="social"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3A//www.mindcollapse.com/blog/274.html">фейсбуке</a>, <a target="_blank" href="http://twitter.com/share?url=https%3A//www.mindcollapse.com/blog/274.html&amp;text=%D0%9F%D0%B8%D1%88%D0%B5%D0%BC%20Skype%20%D0%B1%D0%BE%D1%82%20%D1%81%20%D0%B8%D1%81%D0%BA%D1%83%D1%81%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%BC%D0%B8%20%D0%BC%D0%BE%D0%B7%D0%B3%D0%B0%D0%BC%D0%B8&amp;via=middlesizetit">твиттере</a> или <a target="_blank" href="http://vkontakte.ru/share.php?url=https%3A//www.mindcollapse.com/blog/274.html">в контакте</a></span>.</p>
    </footer>

    </main>
</body>

</html>
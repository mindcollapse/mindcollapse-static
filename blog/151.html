<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">

    <title>С чем едят MySQL prepared statements</title> 

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="jm8IGIWg4dsm0cTmih0sIVnUaWibc_hpOiQOlqb--9Y"> 
    <meta name="yandex-verification" content="4b85f46617ab1114"> 
    <meta name="y_key" content="04bed234d6a405cc"> 
    <meta name="msvalidate.01" content="62188F55275960794DDFA698C3EA9F05">

    <link rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.ru">
    <link rel="sitemap" href="https://www.mindcollapse.com/blog/sitemap.xml">

    
        <link rel="canonical" href="https://www.mindcollapse.com/blog/151.html">

        
            <link rel="next" href="https://www.mindcollapse.com/blog/150.html">
        

        
            <link rel="prev" href="https://www.mindcollapse.com/blog/152.html">
        

        <meta property="og:title" content="С чем едят MySQL prepared statements">
        <meta property="og:description" content="Правду говорил Анонимус: век живи - век учись. Еще в версии 4.1 в mysql появилась такая вещь, как prepared statements, а узнал я это только вчера, перелистывая от нечего делать умирающий habrahabr - статьи стали занудными копипастами и любительскими ...">
        <meta property="og:type" content="article">
        <meta property="og:site_name" content="mindcollapse.com">
        <meta property="og:url" content="https://www.mindcollapse.com/blog/151.html">

        <meta name="description" content="Правду говорил Анонимус: век живи - век учись. Еще в версии 4.1 в mysql появилась такая вещь, как prepared statements, а узнал я это только вчера, ...">

        <meta name="twitter:creator" content="@middlesizetit">
        <meta name="twitter:description" content="Правду говорил Анонимус: век живи - век учись. Еще в версии 4.1 в mysql появилась такая вещь, как prepared statements, а узнал я это только вчера, перелистывая от нечего делать ...">
        <meta name="twitter:title" content="С чем едят MySQL prepared statements">

        
            <meta name="twitter:card" content="summary">
        
    

    <link rel="publisher" href="https://plus.google.com/110904145311662435301">
    <link rel="icon" href="https://www.mindcollapse.com/favicon.ico" type="image/vnd.microsoft.icon">
    <link rel="alternate" type="application/atom+xml" title="RSS лента mindcollapse.com" href="https://www.mindcollapse.com/blog.xml"> 

    
        <link href="/static/compiled/blog.css?85fbe913" rel="stylesheet" media="all">
    

    
        <script type="text/javascript" async src="/static/compiled/blog.js?06c0e12a"></script>
    

    <!--[if lt IE 9]>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js"></script>
    <![endif]-->
</head>

<body class="mindcollapse">
    <main class="container">
        <header class="header navbar navbar-default hidden-print">
            <nav class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".blogmenu">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a href="/" class="navbar-brand">Владимир Смирнов</a>
            </nav>

            <nav class="collapse navbar-collapse blogmenu" role="navigation">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="/">Блог</a></li>
                    <li ><a href="/blog/archive/">Архив</a></li>
                    <li><a target="_blank" href="/moho/">Кино</a></li>
                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <li><a target="_blank" href="http://www.twitter.com/middlesizetit">Twitter</a></li>
                    <li><a target="_blank" href="https://github.com/mindcollapse">GitHub</a></li>
                    <li><a href="https://www.mindcollapse.com/blog.xml">RSS</a></li>
                </ul>
            </nav>
        </header>

        
    <article class="article hentry" itemscope itemtype="http://schema.org/Article" role="main">
        <div class="content_header clearfix">
            <div itemprop="name" class="entry-title pull-left">
                <h1><a itemprop="url" href="https://www.mindcollapse.com/blog/151.html">С чем едят MySQL prepared statements</a></h1>
            </div>

            <div class="published pull-right">
                <time itemprop="datePublished" datetime="2008-09-24T00:00:00Z" class="text-muted updated">24 сентября 2008 г.</time>
            </div>

            <div class="vcard author hidden">
                <a itemprop="author" class="url fn" href="http://www.mindcollapse.com/">Vladimir Smirnov</a>
            </div>
        </div>

        <hr class="first">

        <div itemprop="description" class="entry-content content">
            Прав­ду го­во­рил Ано­ни­мус: век жи­ви - век учись. Еще в вер­сии 4.1 в mysql&nbsp;по­яви­лась та­кая вещь, как&nbsp;<a href="http://dev.mysql.com/doc/refman/5.0/en/sql-syntax-prepared-statements.html">prepared statements</a>, а узнал я это толь­ко вче­ра, пе­ре­ли­сты­вая от не­че­го де­лать уми­ра­ю­щий <a href="http://habrahabr.ru/">habrahabr</a> - ста­тьи ста­ли за­нуд­ны­ми ко­пи­па­ста­ми и лю­би­тель­ски­ми пе­ре­во­да­ми, но я не об этом. Что же это за сло­во­со­чи­та­ние, пе­ре­ве­ден­ное <a href="http://translate.google.com/translate_t#en|ru|preparedstatements">Google Translate</a> как "под­го­тов­лен­ные за­яв­ле­ния" =)? На­вер­ня­ка, каж­дый, кто хоть раз за­ду­мы­вал­ся о за­щи­те сво­е­го при­ло­же­ния&nbsp;от инъ­ек­ций в ба­зу дан­ных, смот­рел в сто­ро­ну биб­лио­тек с с под­держ­кой placeholder-ов, а ока­за­лось, что все это мож­но де­лать не­по­сред­ствен­но син­так­си­сом mysql. Вот вам на за­мет­ку не­боль­шой лик­без.Ис­поль­зо­ва­ние prepared statements да­ет не­пло­хой при­рост как к без­опаст­но­сти, так и к про­из­во­ди­тель­но­сти. Что ка­са­ет­ся пер­во­го, то при под­ста­нов­ке пе­ре­мен­ных в го­то­вый за­прос сер­вер ав­то­ма­ти­че­ски экра­ни­ру­ет все сим­во­лы, что в прин­ци­пе сво­дит ве­ро­ят­ность ле­во­го UNION-а, JOIN-а, ли­бо дру­гой па­ко­сти к ну­лю. Что ка­са­ет­ся ско­ро­сти, то тут то­же есть свои ин­те­рес­но­сти. Во-пер­вых, при мно­го­крат­но по­вто­ря­ю­щих­ся од­но­тип­ных за­про­сах зна­чи­тель­но ми­ни­ми­зи­ру­ет­ся траф­фик меж­ду про­грам­мой и сер­ве­ром БД, ну а во-вто­рых mysql про­ве­ря­ет син­так­сис за­про­са и пар­сит его все­го 1 раз, при ини­ци­а­ли­за­ции placeholder-а. Вы мо­же­те ис­поль­зо­вать дан­ный функ­ци­о­нал на INSERT, DELETE, UPDATE, SELECT и CREATE TABLE за­про­сах. Ра­бо­та­ет, сле­дуя ма­ну­а­лу, это сле­ду­ю­щим об­ра­зом. Сна­ча­ла под­го­тав­ли­ва­ем за­прос для даль­ней­ше­го ис­поль­зо­ва­ния <span style="font-style: italic;">PREPARE getgoodprice FROM "SELECT `price` FROM `goods` WHERE `id`=?"</span>. По­сле это­го мо­жем под­став­лять зна­че­ния в плей­с­хол­дер, вы­пол­нив <span style="font-style: italic;">SET @goodid = 5</span>. Эту пе­ре­мен­ную мы и под­став­ля­ем в за­прос <span style="font-style: italic;">EXECUTE getgoodprice USING @goodid</span>, по­лу­чая ана­лог за­про­са <span style="font-style: italic;">SELECT `price` FROM `goods` WHERE `id`=5</span>. Вот так вот все про­сто. Ра­зу­ме­ет­ся, на еди­нич­ных query на­мно­го луч­ше экра­ни­ро­вать пе­ре­да­ва­е­мые зна­че­ния по­сред­ством функ­ции язы­ка про­грам­ми­ро­ва­ния, но для мно­же­ства слож­ных за­про­сов с не­сколь­ки­ми па­ра­мет­ра­ми вы­бор­ки ли­бо сор­ти­ров­ки PREPARE под­хо­дит на ура. Ах да, из па­мя­ти со­хра­нен­ный за­прос уда­ля­ет­ся по­сред­ством <span style="font-style: italic;">DEALLOCATE PREPARE getgoodpric</span>.
        </div>
    </article>

    <hr>

    <footer class="footer hidden-print">
        <p>Что делать, если вы все прочитали и вам понравилось? Можете посмотреть мои остальные статьи в <a href="/blog/archive/">архиве</a> или поделиться радостью со своими воображаемыми друзьями в социальных сетях: <span class="social"><a target="_blank" href="http://www.facebook.com/sharer.php?u=https%3A//www.mindcollapse.com/blog/151.html">фейсбук</a>, <a target="_blank" href="http://twitter.com/share?url=https%3A//www.mindcollapse.com/blog/151.html&amp;text=%D0%A1%20%D1%87%D0%B5%D0%BC%20%D0%B5%D0%B4%D1%8F%D1%82%20MySQL%20prepared%20statements&amp;via=middlesizetit">твиттер</a>, <a target="_blank" href="http://vkontakte.ru/share.php?url=https%3A//www.mindcollapse.com/blog/151.html">вконтакте</a></span>.</p>
    </footer>

    </main>   
</body>

</html>